<!DOCTYPE html>
<html lang="en">
<title>&#127912 NZ Art App</title>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="canonical" href="https://nzart.app/api/generator" />
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#2b5876" />
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#2b5876" />

    <meta name="description"
        content="NZ Art App - Use the power of Stable-Diffusion to create mind blowing art from just a text description">
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_NZ" />
    <meta property="og:url" content="https://nzart.app" />
    <meta property="og:title" content="NZ Art App" />
    <meta property="og:description"
        content="Create mind blowing art in seconds for free. Utilizing stable-diffusion this text-to-image model enables multiple high resolution images to be wished into existence at a time." />
    <meta property="og:image" content="https://nzartapp.blob.core.windows.net/www/nzart-app.jpg" />
    <link rel="apple-touch-icon" sizes="180x180"
        href="https://nzartapp.blob.core.windows.net/www/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32"
        href="https://nzartapp.blob.core.windows.net/www/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16"
        href="https://nzartapp.blob.core.windows.net/www/favicon-16x16.png">
    <link rel="manifest"
        href="https://nzart.app/api/read?resource=site.webmanifest&code=YCW-FUCxhNKbgYs7u0QnNFAfP9-memmVW9ptBFAg6tPWAzFufEQdHg==">
</head>
<!-- Google tag (gtag.js) and ads -->
<script defer="true" async src="https://www.googletagmanager.com/gtag/js?id=G-2QSZV6W319"></script>
<script defer="true" async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7996261445365362"
    crossorigin="anonymous"></script>
<script
    defer="true">window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-2QSZV6W319');</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    html {
        height: auto;
        font-family: 'Roboto', sans-serif;
    }

    /*Helpful in terms of calculating sizes*/
    * {
        box-sizing: border-box;
    }

    @keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
    }

    /* Create two equal columns that floats next to each other */
    .column {
        float: left;
        padding: 10px;
    }

    .column img {
        width: 100%;
        animation: fadein 2s ease-in-out;
    }

    .container:has(img:hover) {
        scale: .8;
        opacity: .7;
        transition: scale 350ms ease, opacity 350ms linear;
    }

    /* Clear floats after the columns */
    .row:after {
        content: "";
        display: table;
        clear: both;
    }

    body {
        margin: 0;
        font-family: Arial;
        overflow: scroll;
        max-width: 1088px;
        height: 100%;
        background-repeat: no-repeat;
        background-attachment: fixed;
        margin: auto;
        overflow: scroll;
        background: linear-gradient(to top, #4e4376, #2b5876)fixed;
        overflow-x: hidden;
    }

    textarea {
        border-radius: 4px;
        font-family: 'Roboto', sans-serif;
    }

    textarea:hover,
    textarea:focus {
        box-shadow: 0px 0px 10px 5px #ffffc854;
        transition: all 0.2s ease-in;
        border-radius: 4px;
    }

    img:hover {
        box-shadow: 0px 0px 10px 5px #ffffc854;
        transition: all 0.2s ease-in;
    }

    button:hover {
        box-shadow: 0px 0px 10px 5px #ffffc854;
        transition: all 0.2s ease-in;
    }

    .container {
        height: auto;
        display: flex;
    }

    .loader {
        box-shadow: none !important;
    }

    #installContainer {
        position: absolute;
        bottom: 1em;
        display: flex;
        justify-content: center;
        width: 100%;
    }

    #installContainer button {
        background-color: inherit;
        border: 1px solid white;
        color: white;
        font-size: 1em;
        padding: 0.75em;
    }

    #userinput {
        margin: 0;
        position: absolute;
        top: 50%;
        -ms-transform: translateY(-50%);
        transform: translateY(-50%);
        color: white;
        font-size: large;
        animation: fadein 1s ease-in-out;
    }
   
    button {
        font-family: 'Roboto', sans-serif;
        font-size: x-large;
        border-radius: 4px;
    }

    #prompt {
        font-size: x-large;
        font-family: 'Roboto', sans-serif;
    }

    .chaoslabel {
        font-family: 'Roboto', sans-serif;
    }

    .inspirationheader {
        background: linear-gradient(to top, #4e4376, #2b5876);
        padding: 0px;
        align-items: center;
        display: none;
        font-family: 'Roboto', sans-serif;
    }

    .inspirationheader>h1 {
        color: white;
        clear: both;
        padding: 10px;
        font-family: 'Roboto', sans-serif;
    }

    .inspirationheader>p {
        color: white;
        padding: 0px 10px 0px 10px;
        font-family: 'Roboto', sans-serif;
    }
    .inspiration img{
        animation: fadein 1s ease-in-out;
    }
    a{        
        padding:5px;
        color: white;
        font-size: x-large;
        font-family: 'Roboto', sans-serif;
    }
    a:hover{
        color: #ffff00f8;
        transition: all 0.2s ease-in;
    }
</style>
<!--<div id ="header" style="text-align:center">
    <a href="https://nzart.app/">
        <img src="https://nzartapp.blob.core.windows.net/www/nzartlogo.jpg" alt="NZ Art Logo" style="width:20%">
    </a>
    <a href="https://nzart.app/">
        <h1 style="color:white">NZ Art</h1>
    <a href="https://nzart.app/api/content/about"> | About |</a>
    <a href="https://nzart.app/api/content/about"> | Artists |</a>
    <a href="https://nzart.app/api/content/about"> | Contributing |</a>
    <a href="https://nzart.app/api/content/about"> | Extending |</a>
</div>-->

<div id="content">
    <div class="userinput" id="userinput" style="padding:1%;align-items: center;color:white;font-size:x-large">
        <textarea title="prompt input" placeholder="Describe an image you want to like to see"
            label="Enter what you want to see" id="prompt"
            style="text-align:center;width:100%;padding:5px;font-weight:bold;font-family: 'Roboto', sans-serif;"
            autocomplete="off"></textarea>

        <button type="button" id="btnCreate" onload="fixUrl()" onclick="create()"
            style="padding:5px;margin:auto;width:40%;float:left;background:#ffffff00;color:white;border-color:white;margin-top:2px;">üé®
            Create Art</button>
        <button type="button" id="btnShare" onclick="share(this)"
            style="padding:5px;margin:auto;width:40%;float:left;background:#ffffff00;color:white;border-color:white;margin-top:2px;">&#x1F517;
            Share
            link</button>
        <button type="button"
            style="padding:5px;margin:auto;width:20%;float:right;background:#ffffff00;color:white;border-color:white;margin-top:2px;"
            onclick="reset()">‚ùé Clear</button>
        <input type="checkbox" id="chaos"><label class="chaoslabel">New outputs from the same prompt</label>
        <!--<p><label style="font-size:small"><i>NSFW prompts results are censored temporarily, toggle coming soon..</i></label>-->
        </checkbox>
        <!--<button id="btnDownload"
                style="padding:5px;margin:auto;width:25%;margin-left:5%;" onclick="downloadAll()">Download</button>-->
    </div>
    <flexbox id="container" onload="fixUrl();"></flexbox>

    <div id="inspirationHeader" class="inspirationheader">
        <h1>Inspiration</h1>
        <p>Here are some prompts that others have used - Click the prompt text to copy into the
            generator prompt box.
            Powered by <a href="https://lexica.art/" style="color:white;">Lexica.art</a></p>
        <flexbox id="inspiration"></flexbox>
    </div>

    <!-- Install button, hidden by default -->
    <div id="installContainer" style="display:none;">
        <button id="butInstall" type="button">
            Install
        </button>
    </div>

    <script defer>
        let seeds = [];
        const divInstall = document.getElementById('installContainer');
        const butInstall = document.getElementById('butInstall');
        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });

        let imagesLoaded = 0;
        let numberToCreate = 6;
        if (params.iteration != undefined) {
            numberToCreate = params.iteration;
        }

        var input = document.getElementById("prompt");
        input.addEventListener("keydown", function (e) {
            if (e.code === "Enter" || e.code === 13) {
                create();
            }
        });

        function resetState() {
            var share = document.getElementById("btnShare");
            share.innerHTML = "&#x1F517; Share link";
        }

        function fixUrl() {
            //remove query params to not interfere with sharing again in the future
            try {
                console.log(`If you're reading this, something either went wrong or right`);
                console.log(`For feature requests, or issues please e-mail: jm@nzart.app`);
                reset();
                window.history.pushState("https://nzart.app/api/generator", "NZ Art App", "/");
            } catch (e) {
                //do nothing - likely running locally
            }
        }

        // Get the value of "prompt" in eg "https://example.com/?prompt=some_value"
        let seed = params.seed;
        let queryPrompt = params.prompt; // "prompt"      
        if (queryPrompt != undefined) {
            console.log(`prompt:${queryPrompt}-seed:${seed}`);
            var input = document.getElementById("prompt");
            input.value = queryPrompt;
            fixUrl();
            create();
        }
        let id = params.id;
        if (id != undefined && id.length == 36) {
            console.log(`id:${id}`);
            fixUrl();
            fetchPrompt(id);
        }

        function fetchPrompt(id) {
            //downloads data from: https://nzartificialartifacts.azurewebsites.net/api/url-helper?id=id=1bbe7cdb-0c67-4a70-9df8-f5eca84a8efc&code=3gMnVAfKvJOS9vPM4RKS6djoGEMlOBylE3Q_SONGrUHJAzFut5Zvyw== and creates based off the PromptText in the JSON returned
            try {
                var url = `https://nzart.app/api/url-helper?id=${id}&code=3gMnVAfKvJOS9vPM4RKS6djoGEMlOBylE3Q_SONGrUHJAzFut5Zvyw==`;
                apiFetch(url, function (response) {
                    console.log(response);
                    var input = document.getElementById("prompt");
                    input.value = response.PromptText;
                    var seedsToUse = response.Seeds.split(',');
                    create(seedsToUse);
                });
            }
            catch (e) {
                console.log(e);
            }
        }

        function savePrompt(prompt) {
            var url = `https://nzart.app/api/url-helper?prompt=${prompt}&seeds=${seeds}&source=nzart&code=3gMnVAfKvJOS9vPM4RKS6djoGEMlOBylE3Q_SONGrUHJAzFut5Zvyw==`;
            var xhr = new XMLHttpRequest();
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            //parse json response
            xhr.send();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var RowKey = JSON.parse(xhr.responseText).RowKey;
                    console.log(`Saved RowKey: ${RowKey}`);
                    let shareableUrl = `https://nzart.app/api/generator?id=${RowKey}`;
                    // Copy the text inside the text field
                    navigator.clipboard.writeText(shareableUrl);
                    var btnShare = document.getElementById("btnShare");
                    btnShare.innerHTML = "&#x2705; - Copied URL to clipboard";
                }
            };
        }

        function share(object) {
            var prompt = document.getElementById("prompt").value;
            if(prompt.length > 0){
                savePrompt(prompt);
                object.innerHTML = "üíæ Saving...";
                setTimeout(resetState, 4000);
            }
            else{
                object.innerHTML = "‚ö†Ô∏è - Enter a prompt first";
                setTimeout(resetState, 2000);
            }           
        }

        var shuffuleId = "";
        function shuffleTitle() {
            //updates the title of the webpage every second
            shuffleId = setInterval(function () {
                var emojis = ["üë®‚Äçüé®", "üë©‚Äçüé®", "üñºÔ∏è", "üé®", "üé≠"];
                document.title = emojis[Math.floor(Math.random() * emojis.length)] + " NZ Art App";
            }, 1000);
        }

        //function to check every 500ms whether imagesLoaded is equal to numberToCreate
        function loadCheck() {
            setInterval(function () {
                console.log(`Images Loaded:${imagesLoaded}/${numberToCreate}`);
                if (imagesLoaded >= numberToCreate) {
                    imagesLoaded = 0;
                    console.log("All image requests finished");
                    var btnCreate = document.getElementById("btnCreate");
                    btnCreate.innerHTML = "üé® Create Art";
                    if (shuffuleId != "") {
                        clearInterval(shuffleId);
                    }
                }
            }, 500);
        }

        function apiFetch(url, callback) {
            fetch(url)
                .then(response => response.json())
                .then(data => callback(data));
        }

        function inspirationLoader(prompt) {
            var inspirationHeader = document.getElementById("inspirationHeader");
            inspirationHeader.style = "display:inline;"
            apiFetch(`https://lexica.art/api/v1/search?q=${prompt}`, function (data) {
                //sort data based by the height attribute - high to low
                data.images.sort(function (a, b) {
                    return a.height - b.height;
                }).reverse();

                var container = document.getElementById("inspiration");
                container.innerHTML = "";
                for (var i = 0; i < data.images.length; i++) {
                    const link = document.createElement("a");
                    var column = document.createElement("div");
                    column.className = "column";
                    column.style = "width:50%;height:auto;";

                    var img = document.createElement("img");
                    img.setAttribute("loading", "lazy");
                    img.src = data.images[i].src;
                    img.style = "height:auto;";
                    img.alt = data.images[i].prompt;
                    link.href = data.images[i].src;

                    var header = document.createElement("div");

                    header.onclick = function () {
                        //bit of a hack to get the full prompt which is stored in the alt text                      
                        var fullPrompt = this.parentElement.childNodes[0].alt;
                        var prompt = document.getElementById("prompt");
                        prompt.value = fullPrompt;
                        navigator.clipboard.writeText(fullPrompt);
                        prompt.focus();
                        this.innerHTML = "&#x2705; - Copied to clipboard";
                    }
                    header.innerHTML = `${data.images[i].prompt.split(' ').slice(0, 10).join(' ')}...`;
                    header.style = "color:white;margin:10px;text-align:center;";
                    column.appendChild(img);
                    column.appendChild(link);
                    column.appendChild(header);
                    container.appendChild(column);
                }
            });
        }

        function reset() {
            var prompt = document.getElementById("prompt");
            prompt.value = "";
            document.getElementById("btnCreate").innerHTML = "üé® Create Art";
            document.getElementById("container").innerHTML = "";
            document.getElementById("inspiration").innerHTML = "";
            document.getElementById("inspirationHeader").style = "display:none;";
            document.getElementById("userinput").style = "margin: 0;position: absolute;top: 50%;-ms-transform: translateY(-50%);transform: translateY(-50%);color:white;font-size:large;transition: transform .3s ease-out;"
        }

        function create(seedsToUse) {
            var prompt = sanitize(document.getElementById("prompt").value);
            var container = document.getElementById("container");
            var userinput = document.getElementById("userinput").style = "padding:5px;position:relative;transform:translateY(0%);transition: transform .3s ease-out;";
            seeds = [];

            //empty container of all children
            container.innerHTML = "";
            if (prompt != undefined && prompt != "") {
                console.log("Creating...");
                //document.getElementById("installContainer").style = "display:block";        

                inspirationLoader(prompt);
                //shuffleTitle();
                loadCheck();

                for (let i = 1; i <= numberToCreate; i++) {
                    const col = document.createElement("div");
                    const link = document.createElement("a");
                    var seed = i;
                    var btnCreate = document.getElementById("btnCreate");
                    col.className = "column";
                    const img = new Image();
                    const loader = new Image();
                    loader.src = "https://nzartapp.blob.core.windows.net/www/spinner.svg";
                    loader.classList.add('loader');
                    loader.id = "loader";
                    loader.style = "width:fit-content;min-width:300px;"

                    img.onload = function () {
                        document.title = "NZ Art App";
                        loader.style = "display:none;width:0px;";
                        imagesLoaded++;
                    }
                    img.onerror = function () {
                        img.src = "https://nzartapp.blob.core.windows.net/www/server-buddy.png";
                        img.style = "width:512px;";
                        document.title = "Arificial Artifacts"
                        imagesLoaded++;
                    };
                    btnCreate.innerHTML = "&#x1F914; - Creating...";
                    document.title = "Creating...";

                    //get whether chaos element is checked
                    var chaos = document.getElementById("chaos").checked;
                    if (chaos) {
                        //overwrite seed with random number
                        seed = Math.floor(Math.random() * 1000000);
                    }

                    seeds.push(seed);

                    //provided ?test = true will use a test image
                    if (seedsToUse != undefined) {
                        img.alt = `${prompt} - with seed ${seedsToUse[i - 1]}`;
                        img.src = `https://nzart.app/api/download/${prompt}?prompt=${prompt}&seed=${seedsToUse[i - 1]}`;
                        seeds.push(seedsToUse[i - 1]);
                    }
                    else if (params.test != undefined) {
                        img.src = "https://api.computerender.com/generate/blue-barn-with-a-red-door.png";
                        link.href = `https://nzart.app/api/download/${prompt}?prompt=${prompt}&seed=${seed}`;
                    }
                    else {
                        img.alt = `${prompt} - with seed ${seed}`;
                        img.src = `https://nzart.app/api/duplicator?prompt=${prompt}&seed=${seed}`;
                        link.href = `https://nzart.app/api/download/${prompt}?prompt=${prompt}&seed=${seed}`;
                    }
                    link.appendChild(loader);
                    link.appendChild(img)

                    link.download = `${prompt}-${i}.png`;
                    link.target = "_blank";
                    col.appendChild(link);

                    container.appendChild(col);

                    prompt.value = undefined;
                }
            }
        }

        function sanitize(prompt){
            return prompt.replace(/[^a-zA-Z0-9 ]/g, "");
        }

        /*SERVICE_WORKER - Docs: https://web.dev/codelab-make-installable/*/
        // Initialize deferredPrompt for use later to show browser install prompt.
        window.addEventListener('beforeinstallprompt', (event) => {
            // Prevent the mini-infobar from appearing on mobile.
            event.preventDefault();
            console.log('üëç', 'beforeinstallprompt', event);
            // Stash the event so it can be triggered later.
            window.deferredPrompt = event;
            // Remove the 'hidden' class from the install button container.
            divInstall.classList.toggle('hidden', false);
        });

        butInstall.addEventListener('click', async () => {
            console.log('üëç', 'butInstall-clicked');
            const promptEvent = window.deferredPrompt;
            if (!promptEvent) {
                // The deferred prompt isn't available.
                return;
            }
            // Show the install prompt.
            promptEvent.prompt();
            // Log the result
            const result = await promptEvent.userChoice;
            console.log('üëç', 'userChoice', result);
            // Reset the deferred prompt variable, since
            // prompt() can only be called once.
            window.deferredPrompt = null;
            // Hide the install button.
            divInstall.classList.toggle('hidden', true);
        });

        window.addEventListener('appinstalled', (event) => {
            console.log('üëç', 'appinstalled', event);
            // Clear the deferredPrompt so it can be garbage collected
            window.deferredPrompt = null;
        });

        try {
            /* Only register a service worker if it's supported */
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('https://nzart.app/api/read?resource=service-worker.js&code=YCW-FUCxhNKbgYs7u0QnNFAfP9-memmVW9ptBFAg6tPWAzFufEQdHg==');
            }

            worker.postMessage("send message to worker");
            worker.onmessage = function (message) {
                console.log(`recieved:${message.data} from worker`);
            }
        }
        catch (Exception) {
            console.log("Service worker not configured properly");
        }
    </script>

</html>
